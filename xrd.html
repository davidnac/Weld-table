<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRD Diffraction Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        canvas {
            max-width: 800px;
            margin: auto;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 50%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        button {
            margin-top: 10px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h1>XRD Diffraction Analysis</h1>
    <p>Example spectrum for Aluminum Oxide (Al<sub>2</sub>O<sub>3</sub>)</p>
    <canvas id="xrdChart"></canvas>
    
    <table>
        <tr>
            <th>2θ (Degrees)</th>
            <th>Intensity</th>
            <th>hkl</th>
        </tr>
        <tbody id="dataTable">
            <tr><td><input type="number" value="25.6"></td><td><input type="number" value="100"></td><td>(012)</td></tr>
            <tr><td><input type="number" value="35.1"></td><td><input type="number" value="80"></td><td>(104)</td></tr>
            <tr><td><input type="number" value="37.8"></td><td><input type="number" value="90"></td><td>(110)</td></tr>
            <tr><td><input type="number" value="43.3"></td><td><input type="number" value="70"></td><td>(113)</td></tr>
            <tr><td><input type="number" value="52.5"></td><td><input type="number" value="60"></td><td>(024)</td></tr>
            <tr><td><input type="number" value="57.5"></td><td><input type="number" value="50"></td><td>(116)</td></tr>
            <tr><td><input type="number" value="66.6"></td><td><input type="number" value="40"></td><td>(214)</td></tr>
            <tr><td><input type="number" value="76.9"></td><td><input type="number" value="30"></td><td>(300)</td></tr>
        </tbody>
    </table>
    <button onclick="updateChart()">Update Spectrum</button>
    
    <script>
        function updateChart() {
            const ctx = document.getElementById("xrdChart").getContext("2d");
            const tableRows = document.querySelectorAll("#dataTable tr");
            let peaks = [], intensities = [], hklLabels = [];
            
            tableRows.forEach(row => {
                const cells = row.querySelectorAll("td input");
                const hkl = row.cells[2].textContent;
                
                peaks.push(parseFloat(cells[0].value));
                intensities.push(parseFloat(cells[1].value));
                hklLabels.push(hkl);
            });
            
            const peakData = peaks.map((theta, index) => (
                [{ x: theta, y: 0 }, { x: theta, y: intensities[index] }, { x: theta, y: 0 }]
            )).flat();
            
            if (window.myChart) {
                window.myChart.destroy();
            }
            
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'XRD Intensity',
                        data: peakData,
                        borderColor: 'blue',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        showLine: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.raw.y === 0) return '';
                                    const index = peaks.indexOf(context.raw.x);
                                    return `2θ: ${context.raw.x}°, Intensity: ${context.raw.y}, hkl: ${hklLabels[index]}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '2θ (Degrees)'
                            },
                            type: 'linear'
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Intensity (Arbitrary Units)'
                            }
                        }
                    }
                }
            });
        }
        
        document.addEventListener("DOMContentLoaded", updateChart);
    </script>
</body>
</html>
