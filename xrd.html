<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRD Diffraction Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        canvas {
            width: 50% !important;
            margin: auto;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 50%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        button {
            margin-top: 10px;
            padding: 5px 10px;
        }
        input{
            width: 100px;
            text-align: center;
            padding: 6px 8px;
        }
    </style>
</head>
<body>
    <h1>XRD Diffraction Analysis</h1>
    <p>Example spectrum for Aluminum Oxide (Al<sub>2</sub>O<sub>3</sub>)</p>
    <canvas id="xrdChart"></canvas>
    
    <table>
        <tbody id="dataTable">
            <tr>
                <th>2θ (Degrees)</th>
                <td><input type="number" value="25.6"></td>
                <td><input type="number" value="35.1"></td>
                <td><input type="number" value="37.8"></td>
                <td><input type="number" value="43.3"></td>
                <td><input type="number" value="52.5"></td>
                <td><input type="number" value="57.5"></td>
                <td><input type="number" value="66.6"></td>
                <td><input type="number" value="76.9"></td>
            </tr>
            <tr>
                <th>Intensity</th>
                <td><input type="number" value="100"></td>
                <td><input type="number" value="80"></td>
                <td><input type="number" value="90"></td>
                <td><input type="number" value="70"></td>
                <td><input type="number" value="60"></td>
                <td><input type="number" value="50"></td>
                <td><input type="number" value="40"></td>
                <td><input type="number" value="30"></td>
            </tr>
            <tr>
                <th>hkl</th>
                <td>(012)</td>
                <td>(104)</td>
                <td>(110)</td>
                <td>(113)</td>
                <td>(024)</td>
                <td>(116)</td>
                <td>(214)</td>
                <td>(300)</td>
            </tr>
        </tbody>
    </table>
    
    <button onclick="updateChart()">Update Spectrum</button>
    
    <script>
       function updateChart() {
    const ctx = document.getElementById("xrdChart").getContext("2d");
    const tableRows = document.querySelectorAll("#dataTable tr");
    let peaks = [], intensities = [], hklLabels = [];
    
    // Iterate over each row and extract the necessary data
    tableRows.forEach((row, rowIndex) => {
        const cells = row.querySelectorAll("td input"); // Get the input elements
        const header = row.querySelector("th").textContent; // Get the header (2θ, Intensity, or hkl)

        if (header === "2θ (Degrees)") {
            // Extract 2θ (Degrees) values
            cells.forEach((cell, index) => {
                peaks.push(parseFloat(cell.value));
            });
        } else if (header === "Intensity") {
            // Extract intensity values
            cells.forEach((cell, index) => {
                intensities.push(parseFloat(cell.value));
            });
        } else if (header === "hkl") {
            // Extract hkl labels
            cells.forEach((cell, index) => {
                hklLabels.push(cell.textContent);
            });
        }
    });

    const peakData = peaks.map((theta, index) => {
        const width = 0.5; // half width (total width = 5 degrees)
        const leftX = theta - width;
        const rightX = theta + width;
        
        // Return data for the peak with its width at zero intensity, but only one point at the peak intensity
        return [
            { x: leftX, y: 0 }, // left side at zero intensity
            { x: theta, y: intensities[index] }, // peak at maximum intensity
            { x: rightX, y: 0 } // right side at zero intensity
        ];
    }).flat();
    
    // Destroy the previous chart if it exists
    if (window.myChart) {
        window.myChart.destroy();
    }
    
    // Create a new chart
    window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'XRD Intensity',
                data: peakData,
                borderColor: "rgba(75, 192, 192, 1)", // Line color
                backgroundColor: "rgba(75, 192, 192, 0.2)", // Fill color
                fill: true,
                borderWidth: 2,
                pointRadius: 0,
                showLine: true,
                tension: 0.05, // Smooth lines
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            if (context.raw.y === 0) return '';
                            const index = peaks.indexOf(context.raw.x);
                            return `2θ: ${context.raw.x}°, Intensity: ${context.raw.y}, hkl: ${hklLabels[index]}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: '2θ (Degrees)'
                    },
                    type: 'linear'
                },
                y: {
                    title: {
                        display: true,
                        text: 'Intensity (Arbitrary Units)'
                    }
                }
            }
        }
    });
}

document.addEventListener("DOMContentLoaded", updateChart);

       
       </script>
</body>
</html>
